{% extends "global/base.html" %}

{% block content %}
<div class="container py-5">

    <!-- CABEÇALHO DO EVENTO -->
    <div class="text-center mb-5">

        <h2 class="fw-bold mb-3 text-primary">
            <i class="bi bi-stars"></i> {{ evento.titulo|default:"Evento" }}
        </h2>

        <div class="d-inline-block px-4 py-3 rounded-4 shadow-sm"
             style="background: linear-gradient(135deg, #e8f0ff, #ffffff); border-left: 5px solid #0d6efd;">

            <p class="mb-2 fw-semibold text-secondary">
                <i class="bi bi-calendar-event fs-5 text-primary"></i>
                <span class="ms-1">{{ evento.data|date:"d/m/Y"|default:"Data não definida" }}</span>
            </p>

            <p class="mb-0 fw-semibold text-secondary">
                <i class="bi bi-geo-alt fs-5 text-danger"></i>
                <span class="ms-1">{{ evento.local|default:"Local não definido" }}</span>
            </p>
        </div>

        <hr class="w-25 mx-auto my-4">

        <h5 class="mt-4 text-muted">
            <i class="bi bi-pencil-square text-primary"></i>
            Preencha os seus dados para confirmar a presença
        </h5>
    </div>

    {% include "global/partials/messages.html" %}

    <div class="row justify-content-center">
        <div class="col-md-6">

            <div class="card shadow-lg border-0 rounded-4">
                <div class="card-body p-4">

                    <!-- FORMULÁRIO DE CÓDIGO (sempre aparece no topo) -->
                    <form method="post" class="mb-4">
                        {% csrf_token %}
                        <input type="hidden" name="step" value="check_code">

                        <label class="form-label fw-semibold">
                            <i class="bi bi-key"></i> Código do Convite
                        </label>

                        <div class="input-group">
                            <input type="text" name="codigo_convite" class="form-control form-control-lg"
                                   placeholder="Insira o código recebido"
                                   {% if convite %} value="{{ convite.codigo_convite }}" readonly {% endif %}
                                   required>

                            <button class="btn btn-primary" type="submit"
                                {% if convite %} disabled {% endif %}>
                                <i class="bi bi-search"></i>
                            </button>
                        </div>
                    </form>

                    <!-- FORMULÁRIO DE DADOS DO CONVIDADO (apenas quando o código é válido) -->
                    {% if convite and form %}
                        <hr class="mb-4">

                        <form method="post">
                            {% csrf_token %}
                            <input type="hidden" name="step" value="confirm">
                            <input type="hidden" name="codigo_convite" value="{{ convite.codigo_convite }}">

                            <div class="mb-3">
                                <label class="form-label fw-semibold">
                                    <i class="bi bi-person-circle"></i> Nome Completo
                                </label>
                                {{ form.nome_completo }}
                                {% if form.nome_completo.errors %}
                                    <div class="text-danger small">{{ form.nome_completo.errors }}</div>
                                {% endif %}
                            </div>

                            <div class="mb-3">
                                <label class="form-label fw-semibold">
                                    <i class="bi bi-phone"></i> Contacto Telefónico
                                </label>
                                {{ form.contacto }}
                                {% if form.contacto.errors %}
                                    <div class="text-danger small">{{ form.contacto.errors }}</div>
                                {% endif %}
                            </div>

                            {% comment %} <div class="mb-4">
                                <label class="form-label fw-semibold">
                                    <i class="bi bi-people"></i> Lugares Reservados
                                </label>
                                {{ form.lugares_reservados }}
                                {% if form.lugares_reservados.errors %}
                                    <div class="text-danger small">{{ form.lugares_reservados.errors }}</div>
                                {% endif %}
                            </div> {% endcomment %}

                            <button type="submit" class="btn btn-success w-100 py-2 fw-semibold">
                                <i class="bi bi-check-circle"></i> Confirmar Presença
                            </button>
                        </form>
                    {% endif %}
                    
                </div>
            </div>

        </div>
    </div>
</div>
{% endblock %}
