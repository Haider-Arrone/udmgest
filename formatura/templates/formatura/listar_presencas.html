{% extends 'global/base.html' %}

{% block title %}Presen√ßas Formatura | {% endblock title %}

{% block content %}
<h2 align="center">Registro de Presen√ßas</h2>

{% include 'global/partials/messages.html' %}

<!-- üîπ Filtros -->
<form method="get" action="{{ form_action }}" class="mb-4">
    <div class="row g-3">
        <div class="col-md-3">
            <label for="id_nome" class="form-label">Nome do Funcion√°rio</label>
            <input type="text" name="nome" id="id_nome" value="{{ nome_query }}" class="form-control">
        </div>
        <div class="col-md-3">
            <label for="id_departamento" class="form-label">Departamento</label>
            <select name="departamento" id="id_departamento" class="form-select">
                <option value="">Todos</option>
                {% for dep in departamentos %}
                    <option value="{{ dep.id }}" {% if dep.id|stringformat:"s" == departamento_id %}selected{% endif %}>{{ dep.nome }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="col-md-2">
            <label for="id_startdate" class="form-label">Data Inicial</label>
            <input type="date" name="startdate" id="id_startdate" value="{{ startdate_query }}" class="form-control">
        </div>
        <div class="col-md-2">
            <label for="id_enddate" class="form-label">Data Final</label>
            <input type="date" name="enddate" id="id_enddate" value="{{ enddate_query }}" class="form-control">
        </div>
        <div class="col-md-2">
            <label for="id_status" class="form-label">Status Presen√ßa</label>
            <select name="status" id="id_status" class="form-select">
                <option value="todos" {% if status_presenca == 'todos' %}selected{% endif %}>Todos</option>
                <option value="presentes" {% if status_presenca == 'presentes' %}selected{% endif %}>Presentes</option>
                <option value="faltosos" {% if status_presenca == 'faltosos' %}selected{% endif %}>Faltosos</option>
            </select>
        </div>
    </div>

    <div class="mt-3">
        <button type="submit" class="btn btn-primary">Filtrar</button>
        <a href="{{ form_action }}" class="btn btn-secondary">Limpar</a>
    </div>
</form>

<!-- üîπ Contadores -->
<div class="mb-3">
    <strong>Total Funcion√°rios:</strong> {{ total_funcionarios }} |
    <strong>Total Registros exibidos:</strong> {{ total_registros }}
</div>

<!-- üîπ Tabela de presen√ßas -->
<table class="table table-striped table-bordered">
    <thead class="table-dark">
        <tr>
            <th>#</th>
            <th>Funcion√°rio</th>
            <th>Departamento</th>
            <th>Data</th>
            <th>Hora de Entrada</th>
            <th>Origem do Registo</th>
        </tr>
    </thead>
    <tbody>
        {% for p in tabela_presencas %}
        <tr>
            <td>{{ forloop.counter }}</td>
            <td>{{ p.nome }}</td>
            <td>{{ p.departamento }}</td>
            <td>{% if p.data_presenca != '-' %}{{ p.data_presenca|date:"d/m/Y" }}{% else %}-{% endif %}</td>
            <td>{% if p.hora_entrada != '-' %}{{ p.hora_entrada|time:"H:i" }}{% else %}-{% endif %}</td>
            <td>{{ p.origem_registo }}</td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="6" class="text-center">Nenhum registro encontrado.</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

{% endblock content %}
