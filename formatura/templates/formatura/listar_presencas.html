{% extends 'global/base.html' %}

{% block title %}Presen√ßas Formatura | {% endblock title %}

{% block content %}
<h2 align="center">Registro de Presen√ßas</h2>

{% include 'global/partials/messages.html' %}

<!-- üîπ Filtros -->
<form method="get" action="{{ form_action }}" class="mb-4">
    <div class="row g-3">
        <div class="col-md-3">
            <label for="id_nome" class="form-label">Nome do Funcion√°rio</label>
            <input type="text" name="nome" id="id_nome" value="{{ nome_query }}" class="form-control">
        </div>
        <div class="col-md-2">
            <label for="id_departamento" class="form-label">Departamento</label>
            <select name="departamento" id="id_departamento" class="form-select">
                <option value="">Todos</option>
                {% for dep in departamentos %}
                    <option value="{{ dep.id }}" {% if dep.id|stringformat:"s" == departamento_id %}selected{% endif %}>{{ dep.nome }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="col-md-2">
            <label for="id_startdate" class="form-label">Data Inicial</label>
            <input type="date" name="startdate" id="id_startdate" value="{{ startdate_query }}" class="form-control">
        </div>
        <div class="col-md-2">
            <label for="id_enddate" class="form-label">Data Final</label>
            <input type="date" name="enddate" id="id_enddate" value="{{ enddate_query }}" class="form-control">
        </div>

         <div class="col-md-2">
    <label for="id_status" class="form-label">Status Presen√ßa</label>
    <select name="status" id="id_status" class="form-select">
        <option value="todos" {% if status_presenca == 'todos' %}selected{% endif %}>Todos</option>
        <option value="presentes" {% if status_presenca == 'presentes' %}selected{% endif %}>Presentes</option>
        <option value="faltosos" {% if status_presenca == 'faltosos' %}selected{% endif %}>Faltosos</option>
    </select>
</div>

    </div>
   

    <div class="mt-3">
        <button type="submit" class="btn btn-primary">Filtrar</button>
        <a href="{{ form_action }}" class="btn btn-secondary">Limpar</a>
    </div>
</form>

<!-- üîπ Contadores -->
<div class="mb-3">
    <strong>Total Funcion√°rios:</strong> {{ relatorio|length }}
</div>

<!-- üîπ Tabela de presen√ßas -->
<table class="table table-striped table-bordered">
    <thead class="table-dark">
        <tr>
            <th>#</th>
            <th>Funcion√°rio</th>
            <th>Departamento</th>
            {% for dia in dias %}
                <th>{{ dia|date:"d/m" }}</th>
            {% endfor %}
        </tr>
    </thead>
    <tbody>
        {% for linha in relatorio %}
        <tr>
            <td>{{ forloop.counter }}</td>
            <td>{{ linha.nome }}</td>
            <td>{{ linha.departamento }}</td>
            {% for p in linha.presencas %}
                <td class="{% if p.status == 'P' %}table-success{% else %}table-danger{% endif %}" title="{{ p.origem_registo }}">
        {{ p.hora_entrada }} {% if p.status %}({{ p.status }}){% endif %}
    </td>
            {% endfor %}
        </tr>
        {% empty %}
        <tr>
            <td colspan="{{ 3|add:dias|length }}" class="text-center">Nenhum registro encontrado.</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

{% endblock content %}