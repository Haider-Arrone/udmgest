
{% block content %}
<div class="d-flex align-items-center mb-3">
    <a href="{% url 'expedient:home' %}" class="btn btn-outline-primary me-3">
        ← Voltar
    </a>
    <h1 class="calendario-titulo mb-0">
        Calendário Académico
    </h1>
</div>


<div id="calendar" class="shadow-sm rounded p-2 bg-white"></div>

<!-- Legenda -->
<div id="legend" class="mt-3 mx-auto"></div>

<!-- FullCalendar -->
<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.7/index.global.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.7/index.global.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.7/locales/pt-br.global.min.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function() {

    const calendarEl = document.getElementById('calendar');
    let cachedEvents = [];
    let legendColors = {};  // título → cor

    const calendar = new FullCalendar.Calendar(calendarEl, {
      
        initialView: 'dayGridMonth',
        locale: 'pt-br',
        themeSystem: 'bootstrap',

        headerToolbar: {
            left: 'prev,next today',
            center: 'title',
            right: 'dayGridMonth'
        },
        buttonText: {
        today: "Hoje",
        month: "Mês",
        week: "Semana",
        day: "Dia",
        list: "Lista"
    },
    
    titleFormat: function(date) {
        const mes = date.date.marker.toLocaleDateString('pt-PT', { month: 'long' });
        const mesFormatado = mes.charAt(0).toUpperCase() + mes.slice(1);
        return mesFormatado + ' ' + date.date.year;
    },

        // Buscar eventos
        events: function(fetchInfo, successCallback) {
            fetch("{% url 'calendario:event_list_api' %}")
                .then(response => response.json())
                .then(data => {
                    cachedEvents = data;

                    // Guardar cores por título para a legenda
                    data.forEach(evt => {
                        if (evt.title && evt.color) {
                            legendColors[evt.title] = evt.color;
                        }
                    });

                    renderLegend();  // Atualiza a legenda
                    successCallback(data);
                });
        },

        // Pintar domingos + dias com eventos
        dayCellDidMount: function(info) {
            const dateOnly = info.el.getAttribute("data-date");
            const day = new Date(dateOnly + "T00:00:00").getDay();

            // Domingo
            if (day === 0) {
                info.el.style.backgroundColor = "#fdecea";
            }

            // Pintar dia conforme evento
            cachedEvents.forEach(evt => {
                if (evt.start === dateOnly && evt.color) {
                    info.el.style.backgroundColor = evt.color;
                    info.el.style.color = "#ffffff";
                }
            });

            // Destaque HOJE
            const today = new Date().toISOString().slice(0, 10);
            if (today === dateOnly) {
                info.el.style.border = "2px solid #0d47a1";
                info.el.style.boxShadow = "0 0 6px rgba(13, 71, 161, 0.3)";
                info.el.style.borderRadius = "10px";
            }
        },

        // Esconder ícones de evento
        eventDidMount: function(info) {
            info.el.style.display = "none";
        },

        height: "auto"
    });

    calendar.render();

    // LEGENDA: usa título → cor
    function renderLegend() {
        const legendDiv = document.getElementById("legend");
        legendDiv.innerHTML = "<h5 class='fw-bold mb-3'>Legenda</h5>";

        const container = document.createElement("div");
        container.className = "d-flex justify-content-center gap-3 flex-wrap";

        Object.keys(legendColors).forEach(title => {
            const item = document.createElement("div");
            item.className = "legend-item shadow-sm";

            item.innerHTML = `
                <span class="legend-color" style="background:${legendColors[title]}"></span>
                ${title}
            `;

            container.appendChild(item);
        });

        legendDiv.appendChild(container);
    }

});
</script>

<style>
.calendario-titulo {
    text-align: center;       /* centraliza horizontalmente */
    font-size: 2.2rem;        /* tamanho do texto */
    color: #0d47a1;           /* cor do título */
    font-weight: 700;         /* negrito */
    margin-top: 40px;          /* espaço acima */
    margin-bottom: 40px;       /* espaço abaixo */
}


  
#calendar {
    max-width: 800px;
    margin: 0 auto;
    border-radius: 14px;
}

.fc .fc-button {
    background-color: #0d47a1 !important;
    border: none !important;
    border-radius: 6px !important;
    font-weight: 500;
}
.fc .fc-button:hover {
    background-color: #0b3c8a !important;
}

.fc-toolbar-title {
    font-size: 2rem !important;
    font-weight: 700 !important;
    color: #0d47a1;
}

.fc-daygrid-day {
    border: 1px solid #e0e0e0 !important;
    transition: transform 0.25s ease, box-shadow 0.25s ease, background-color 0.25s ease;
    border-radius: 8px !important;
    
}
.fc-daygrid-day:hover {
    transform: scale(1.05);          /* aumenta levemente */
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    background-color: #e8f0fe !important; /* muda levemente a cor */
    z-index: 2;                       /* garante que fique acima */
}
.fc-daygrid-day-number {
    font-size: 32px  !important;
    font-weight: 700;
    padding: 8px 0 !important;
    color: #000;
    text-align: center;
    line-height: 40px;                /* centraliza verticalmente dentro do topo */
    margin-bottom: 5px;  
}
.fc-day-today {
    border: 8px solid #0d47a1 !important;          /* borda mais grossa */
    box-shadow: 0 0 10px rgba(13, 71, 161, 0.5);  /* sombra mais intensa */
    border-radius: 12px;
            /* fundo leve azul */
    transform: scale(1.05);                        /* leve aumento */
    transition: transform 0.2s, box-shadow 0.2s;   /* animação suave */
}

{% comment %} .fc .fc-daygrid-week {
    max-height: 70px; /* altura de cada semana */
}
.fc .fc-daygrid-day-frame {
    height: 100% !important; /* ocupa a célula inteira */
}
.fc-daygrid-day-number {
    font-size: 34px !important; /* números menores */
    padding: 2px !important;
} {% endcomment %}
.fc-daygrid-day .fc-daygrid-day-events {
    display: none !important;
}
/* LEGENDA */
#legend {
    max-width: 1000px; /* igual ao calendário */
    margin: 0 auto;
    text-align: center;
}

#legend h5 {
    font-size: 1.2rem;
    margin-bottom: 0.5rem;
    color: #0d47a1;
    font-weight: 600;
}


.legend-container {
    display: flex;
    justify-content: center;
    flex-wrap: wrap; /* Permite quebrar em várias linhas */
    gap: 6px;
}

.legend-item {
    display: flex;
    align-items: center;
    gap: 8px;
    background: #ffffff;
    padding: 8px 14px;
    border-radius: 8px;
    
    font-size: 14px;
    border: 1px solid #dedede;
}
.legend-item:hover {
    transform: translateY(-2px); /* leve efeito hover */
}
.legend-color {
    width: 20px;       /* maior */
    height: 20px;      /* maior */
    border-radius: 6px; /* borda mais arredondada */
    flex-shrink: 0;
    border: 1px solid #ccc; /* contorno suave */
}
</style>

{% endblock %}
